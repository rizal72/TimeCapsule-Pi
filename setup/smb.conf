# Samba configuration for Raspberry Pi Time Machine
# File: /etc/samba/smb.conf

[global]
    # Server identification
    server string = Raspberry Pi Time Machine
    workgroup = WORKGROUP
    netbios name = TIMECAPSULE-PI

    # Logging
    log file = /var/log/samba/log.%m
    max log size = 1000
    log level = 2
    pid directory = /var/run/samba
    lock directory = /var/run/samba

    # SMB Protocol (force SMB2/3, no SMB1)
    min protocol = SMB2
    max protocol = SMB3
    server min protocol = SMB2

    # Time Machine specific options - vfs_fruit
    fruit:time machine = yes
    fruit:delete vacuum files = yes
    fruit:veto apple double = no
    fruit:metadata = stream
    fruit:encoding = native
    fruit:copyfile = yes
    fruit:model = TimeCapsule

    # VFS modules for macOS compatibility
    vfs objects = catia fruit streams_xattr

    # Authentication
    security = user
    passdb backend = tdbsam
    encrypt passwords = yes

    # Performance tuning
    read raw = yes
    write raw = yes
    aio read size = 16384
    aio write size = 16384

    # Network
    bind interfaces only = yes
    interfaces = 127.0.0.1 192.168.1.0/24

# Time Machine Share
[TimeCapsule]
    comment = Time Machine Backup on Raspberry Pi
    path = /mnt/timecapsule
    browseable = yes
    read only = no
    create mask = 0666
    directory mask = 0777
    guest ok = no
    valid users = riccardosallusti

    # Time Machine specific
    # Adjust 'fruit:time machine max size' based on your external drive size
    # Examples: 1T, 2T, 4T, etc.
    fruit:time machine max size = 1T
    vfs objects = catia fruit streams_xattr
